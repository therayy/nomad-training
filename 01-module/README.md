script

So when we talk about nomad, one of the things we see which is really common is this deployment pattern of a single operating system with a single application running on top of that and in this configuration they meet on a top of a single VM.

Now the challenge that we often see with this configuration is you really have two distinct audience here, you have your developer DEV, and the Operation DEV. As the Developer cares about the application lifecycle, so they care about scaling up scaling down changing configuration deploying their new version. But the same time you have you operator audiance and they care about a different set of things, they care about are we running the right version of the OS is it patch do we have enough capacity in our fleet and the challenge is although have a different set of concerns they have to coordinate because the application is running on an OS on a VM at the end of the day.

So what we often see is the development group has to file a ticket, so anytime the development group wants to do anything application lifecycle related there to file a ticket aganist the opertations group and that's the layer at which the coordination is done. (DEVOPS)

The first thing we are looking at when we talk about Nomad, how do we split this so we can have independent workflows, the primary goal of nomad is to sit in between here and disintermiediate and really provide a layer where we have a southbound API focused on the operator and northbound API focused on the developer.

So what does this really mean, from the Developer what we want to do is let them write their job and that;s what Nomad calls it as a job file, which is an infrastucture as code way of declaring everything about their job. So they would say I have this web application I want to run its version 10 of my application and I want three instances of it. And now the developer just submits this job file to Nomads API. Its Nomads responsibility to find space in this cluster to run the job which is 3 instances of this web server, so we might have a hundred node cluster that we are running and know that's going to find 3 machines that have available capacity and deploy the web server there.

Now as a developer when we come back and say you know what I want to deploy version 11 of my application and also specify what deployment strategy I want do I wanna use a canary or blue/green deployment or just a rolling deployment, you will simply change your job file to reflect the new version and resubmit it to Nomads API. And Nomad takes care of these changes across the fleet safely, in addition to just managing deploying our application as well as making changes to it right as we change version or scale up and down so we could easily visit the job file and change our 3 instances and apply the change lets say to 5 and Nomad will go run 2 more copies of this. The other thing it really does is how we automate some of the operational challenges that are historically part of the operationals group. 

So we talk about these sort of operational issues, it's things like how do we make sure if this application crashes that it gets restarted? so we want to make sure that we can greacefully restart the application and ensure it stays online even though it might crashed or experienced an issue. The other side of those what if the machine that we are running on or the rack or the cage or the data center we are running on fails. Well we really want to do is automatically reschedule the application onto a different machine that has capacity. So if Nomad detects that the machine is down, it will automatically find another machine in the cluster to reschedule the application onto, so these are traditionally things where we might have paged someone to go deal with operational issue and provide a reliable service but instead Nomad can handle these situations automatically thats the developer focus in the sort of lifecycle as we talk about the operator.

Operator focus more on the southbound side and they have a few different concerns which is you know like I said are there enough machines on the fleet? with capacity are they patch?are they we running the latest version? So they have a set of needs as well they need to be able to come and say what these ten machines I wanna take them out of the fleet so I can patch them and then bring them back and so they have an API as well where they can come and say, you know what I would like to gracefully drain these 10 machines and over the next 4 hours get all the workload off of them and then I can take it out of service do a patch bring it in and allow workload to go on it.

2nd level challenge we see with nomad is when you look at most infrastructure you have a really bad rate of hardware utilization, now typically less than 2% and so how do we actually solve this because we have all these 8 core 16 core machines that are running an application doing a hundred or a thousand requests a day. Where this is effectively idle we are not making good use of hardware and so the approach nomad takes is to run multiple applications on the same machine so how do we move from place where at less than 2% to be at 20-30% utilization, you might look at this 20-30% doesnt sound like that good why don't we shoot for higher than that?
but we have to realize that is with sort of law of small numbers because we are starting at sort of such a bad place going from 2% to call it 20% what you still get out of this transition is an incredible reduction in your fleet size. So as you go from 2% to 20% its actually a 90% reduction and the amount of overall hardware we are we need we can replace every 10 machines with 1. 

In Sum, there is that Total Cost Optimization (TCO) that comes from running multiple applications and making better use of our resources. So this is the kind of primary focus how do we allow this sort of decoupling and self-service, how do we look at total Cost of Ownership as a secondary goal.

And so then what we haven't really mentioned is we were talking generically about an application running on a machine and this really comes back to how flexible Nomad is.

One side a major use case for Nomad is acting as a container platform, this application that we are deploying might be packaged as a container image and Nomad can orchestrate the deployment of that container across the cluster. This means that developers can take advantage of the benefits of containerization, such as isolation and portability, while still leveraging the powerful scheduling and resource management capabilities of Nomad. 

But what about applications that aren't containerized or that can't easily be containerized this is actually a whole 2nd use case for Nomad, which is both windows as well as legacy applications so when we talk about some of these applications.

So maybe its just a simple C# application that we are deploying on windows or its something more heavyweight that we can't easily containerize. Nomad allows us to run many of these types of workloads without needing to make that sort of transition and packaging format. Common use case is running C# directly on top of windows without containerizing and reporting them to linux. Ends up being a common workflow for us.

Now beyond that the interesting thing is when we talk about sort of north and southbound API, what we are really providing is an API for scheduling work. It could be that we are specifiying our Job and submitting it manually to Nomad. But we can also programmatically consume Nomad's API to deploy jobs and this actually leads to a few interesting use cases. 
- 1st: might call it job queuing or call it a serverless pattern of deployment is when an event comes in how do we translate that event into something that need to execute. Great example is Pipelin, every time a commit comes in the CI has to trigger a build goes in tests (does this cause a change? (yes/no)) and so pipeline has publicly talked how they use Nomad's behind the scenes for their infrastructure so they get a webhook in an event that it commits has taken place, they translate that and submit a job for Nomad to go run that build, and what they see is being able to submit well over a thousand jobs a min to Nomad.






